name: cla phrase check

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

permissions:
  contents: read
  pull-requests: read

jobs:
  cla_phrase_check:
    name: verify cla phrase in pr body
    runs-on: ubuntu-latest

    steps:
      - name: check pr body for required cla phrase
        uses: actions/github-script@v7
        with:
          script: |
            const required = "I agree to the CLA in CLA.md";

            const pr = context.payload.pull_request;
            const body = (pr && pr.body) ? pr.body : "";

            if (!body.includes(required)) {
              core.setFailed(
                [
                  "missing required cla phrase in pr description.",
                  "",
                  "add this exact line to the pr body:",
                  required
                ].join("\n")
              );
            } else {
              core.info("cla phrase found.");
            }
